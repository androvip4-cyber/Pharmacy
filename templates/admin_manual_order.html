<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ ÙŠØ¯ÙˆÙŠ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');

        :root{
            --bg:#f4f6fb;
            --card:#ffffff;
            --ink:#0f172a;
            --muted:#6b7280;
            --primary:#0f9d58;
            --primary-2:#0b7d46;
            --accent:#1976d2;
            --danger:#c62828;
            --shadow:0 8px 28px rgba(15,23,42,0.12);
            --radius:14px;
        }
        *{box-sizing:border-box;}
        body{margin:0; font-family:"Cairo",system-ui,sans-serif; background:var(--bg); color:var(--ink); direction:rtl;}
        .layout{display:grid; grid-template-columns:240px 1fr; min-height:100vh;}
        .sidebar{
            background: linear-gradient(180deg,#0c5131,#0f9d58);
            color:#fff;
            padding:22px 18px;
            display:flex;
            flex-direction:column;
            gap:16px;
        }
        .logo{font-weight:800; font-size:1.2rem;}
        .nav a{
            display:flex; align-items:center; gap:10px;
            padding:10px 12px; color:#e0f2e9; text-decoration:none;
            border-radius:10px; transition:all 160ms ease;
        }
        .nav a:hover{background:rgba(255,255,255,0.1); transform:translateX(-4px);}

        .main{padding:20px 24px 32px;}
        .page-head{display:flex; flex-wrap:wrap; gap:12px; justify-content:space-between; align-items:center; margin-bottom:20px;}
        .page-head h1{margin:0; font-size:1.6rem; display:flex; gap:8px; align-items:center;}

        .card{
            background:var(--card);
            border-radius:var(--radius);
            padding:20px;
            box-shadow:var(--shadow);
            margin-bottom:16px;
        }

        .form-group{
            margin-bottom:16px;
        }
        .form-group label{
            display:block;
            margin-bottom:6px;
            font-weight:700;
            color:var(--ink);
        }
        .form-group input{
            width:100%;
            padding:12px;
            border-radius:10px;
            border:1px solid #e5e7eb;
            font-family:inherit;
            font-size:1rem;
        }
        .form-group input:focus{
            outline:none;
            border-color:var(--primary);
            box-shadow:0 0 0 3px rgba(15,157,88,0.12);
        }

        .products-grid{
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
            gap:12px;
            margin-top:16px;
        }
        .product-item{
            background:#f8fafc;
            border:2px solid #e5e7eb;
            border-radius:10px;
            padding:12px;
            transition:all 160ms ease;
        }
        .product-item:hover{
            border-color:var(--primary);
            box-shadow:0 4px 12px rgba(15,157,88,0.15);
        }
        .product-item h4{
            margin:0 0 8px;
            font-size:0.95rem;
            color:var(--ink);
        }
        .product-item .price{
            color:var(--muted);
            font-size:0.85rem;
            margin-bottom:8px;
        }
        .product-item .stock{
            color:var(--primary);
            font-size:0.85rem;
            font-weight:700;
            margin-bottom:8px;
        }
        .product-item input{
            width:100%;
            padding:8px;
            border-radius:8px;
            border:1px solid #d1d5db;
            text-align:center;
            font-size:1rem;
        }

        .btn{
            background: linear-gradient(90deg,var(--primary),var(--primary-2));
            color:#fff;
            padding:12px 24px;
            border:none;
            border-radius:10px;
            font-weight:700;
            font-size:1rem;
            cursor:pointer;
            box-shadow:0 10px 24px rgba(15,157,88,0.22);
            transition:transform 140ms ease;
            width:100%;
            margin-top:20px;
        }
        .btn:hover{transform:translateY(-1px);}
        .btn:active{transform:translateY(1px);}

        .error{
            background:#fee;
            color:var(--danger);
            padding:12px;
            border-radius:10px;
            margin-bottom:16px;
            border:1px solid #ffcdd2;
        }

        .summary{
            background:#e8f5e9;
            padding:16px;
            border-radius:10px;
            margin-top:16px;
        }
        .summary-row{
            display:flex;
            justify-content:space-between;
            margin:8px 0;
            font-weight:700;
        }
        .summary-total{
            font-size:1.2rem;
            color:var(--primary);
            border-top:2px solid var(--primary);
            padding-top:12px;
            margin-top:12px;
        }

        @media(max-width:980px){
            .layout{grid-template-columns:1fr;}
            .sidebar{flex-direction:row; flex-wrap:wrap;}
        }
        @media(max-width:480px){
            .main{ padding: 12px 16px 20px; }
            .page-head{ margin-bottom: 16px; }
            .page-head h1{ font-size: 1.2rem; }
            .card{ padding: 14px; margin-bottom: 12px; }
            .form-group{ margin-bottom: 12px; }
            .form-group label{ font-size: 0.9rem; margin-bottom: 5px; }
            .form-group input{ padding: 10px; font-size: 1rem; }
            .products-grid{ grid-template-columns: 1fr; gap: 10px; }
            .product-item{ padding: 10px; }
            .product-item h4{ font-size: 0.9rem; }
            .product-item input{ padding: 8px; font-size: 0.95rem; }
            .btn{ padding: 12px; font-size: 0.95rem; }
            .summary{ padding: 12px; }
            .summary-row{ font-size: 0.9rem; }
            .summary-total{ font-size: 1.1rem; }
            .sidebar{ padding: 16px 12px; gap: 12px; }
            .logo{ font-size: 1rem; }
            .nav a{ padding: 8px 10px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="logo">ğŸ¥ Pharma Admin</div>
            <div class="nav">
                <a href="/admin/dashboard">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                <a href="/admin/orders">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
                <a href="/admin/manual_order">â• Ø·Ù„Ø¨ ÙŠØ¯ÙˆÙŠ</a>
                <a href="/admin/profits">ğŸ’° Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</a>
                <a href="/admin/stock_overview">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
                <a href="/admin/logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
            </div>
        </aside>

        <main class="main">
            <div class="page-head">
                <h1>â• ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ ÙŠØ¯ÙˆÙŠ</h1>
                <span style="color:var(--muted);">Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</span>
            </div>

            {% if error %}
            <div class="error">{{ error }}</div>
            {% endif %}

            <form method="POST" id="manual-order-form">
                <div class="card">
                    <h2 style="margin:0 0 16px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label>
                        <input type="text" name="name" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" name="phone" placeholder="01012345678">
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin:0 0 16px;">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
                    {% set stock_count = namespace(value=0) %}
                    <div class="products-grid" id="products-grid">
                        {% for pid, p in products.items() %}
                        {% set ns = namespace(total_qty=0, display_price=0) %}
                        {% if p.batches is defined and p.batches %}
                            {% for b in p.batches %}
                                {% set qty = b.quantity|int if b.quantity is defined else 0 %}
                                {% set ns.total_qty = ns.total_qty + qty %}
                                {% if loop.first %}
                                    {% set ns.display_price = b.price %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {% if ns.total_qty > 0 %}
                            {% set stock_count.value = stock_count.value + 1 %}
                        <div class="product-item">
                            <h4>{{ p.name }}</h4>
                            <div class="price">Ø§Ù„Ø³Ø¹Ø±: {{ ns.display_price }} Ø¬Ù†ÙŠÙ‡</div>
                            <div class="stock">Ø§Ù„Ù…ØªØ§Ø­: {{ ns.total_qty }}</div>
                            <input type="number" name="product_{{ pid }}" min="0" max="{{ ns.total_qty }}" value="0" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% if stock_count.value == 0 %}
                    <div style="padding:20px; text-align:center; color:var(--muted); margin-top:16px;">
                        <p style="margin:0;">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        {% if products|length > 0 %}
                        <p style="margin:8px 0; font-size:0.9rem;">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…: {{ products|length }}</p>
                        {% endif %}
                        <a href="/admin/dashboard" style="display:inline-block; margin-top:12px; color:var(--primary); text-decoration:none; font-weight:700;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                    </div>
                    {% endif %}
                </div>

                <div class="card">
                    <div class="summary">
                        <h3 style="margin:0 0 12px;">Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
                        <div class="summary-row">
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</span>
                            <span id="items-count">0</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                            <span id="total-price">0 Ø¬Ù†ÙŠÙ‡</span>
                        </div>
                    </div>
                    <button type="submit" class="btn">âœ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </form>
        </main>
    </div>

    <script>
        const products = {{ products|tojson }};
        const form = document.getElementById('manual-order-form');
        const inputs = form.querySelectorAll('input[type="number"]');
        const itemsCountEl = document.getElementById('items-count');
        const totalPriceEl = document.getElementById('total-price');

        function updateSummary() {
            let totalItems = 0;
            let totalPrice = 0;

            inputs.forEach(input => {
                const qty = parseInt(input.value) || 0;
                if (qty > 0) {
                    const pid = input.name.replace('product_', '');
                    const product = products[pid];
                    if (product && product.batches && product.batches.length > 0) {
                        const price = parseFloat(product.batches[0].price) || 0;
                        totalItems += qty;
                        totalPrice += qty * price;
                    }
                }
            });

            itemsCountEl.textContent = totalItems;
            totalPriceEl.textContent = totalPrice.toFixed(2) + ' Ø¬Ù†ÙŠÙ‡';
        }

        inputs.forEach(input => {
            input.addEventListener('input', updateSummary);
        });

        updateSummary();
    </script>
</body>
</html>

